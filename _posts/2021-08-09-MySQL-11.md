---
layout: post
title:  "이것이 MySQL이다 - 11. 전체 텍스트 검색과 파티션"
---

# 11.1.2 전체 텍스트 인덱스
- InnoDB와 MyISAM 테이블만 지원
- char, varchar, text 열에만 생성 가능
- 인덱스 힌트의 사용 일부 제한

# 중지 단어
인덱스의 양이 커지므로, 검색할 이유가 없는 단어는 제외하고 생성 가능하다.

# 자연어 검색
특별히 옵션을 지정하지 않거나 IN NATURAL LANGUAGE MODE를 붙이면 자연어 검색.
단어가 정확한 것을 검색해 줌.

SELECT * FROM newspaper 
  WHERE MATCH(article) AGAINST('영화');
'영화' 정확한 단어만 검색됨. '영화는', '한국영화' 등 단어가 들어간 열은 검색x

SELECT * FROM newspaper 
  WHERE MATCH(article) AGAINST('영화 배우');
'영화' 또는 '배우' 두 단어 중 하나가 포함된거 검색.

# 불린 모드 검색
- 단어가 정확히 일치하지 않는 것도 검색. IN BOOLEAN MODE 옵션을 붙여줘야 함
- 필수 '+', 제외 '-', 부분 검색 '*' 등

SELECT * FROM newspaper 
   WHERE MATCH(article) AGAINST('영화*' IN BOOLEAN MODE);
'영화를' 등..

SELECT * FROM newspaper 
   WHERE MATCH(article) AGAINST('영화 배우' IN BOOLEAN MODE);
'영화 배우' 단어가 정확하게

SELECT * FROM newspaper 
   WHERE MATCH(article) AGAINST('영화 배우 +공포' IN BOOLEAN MODE);

SELECT * FROM newspaper 
   WHERE MATCH(article) AGAINST('영화 배우 -남자' IN BOOLEAN MODE);
   
SHOW VARIABLES LIKE 'innodb_ft_min_token_size';
3글자 이상만 전체 텍스트 인덱스로 생성. 변경하려면 my.ini 파일의 [mysqld] 아래 아무곳에나 행 추가하고 MySQL 서비스 재시작
innodb_ft_min_token_size=2

- 전체 텍스트 인덱스로 만들어진 단어 확인
SET GLOBAL innodb_ft_aux_table = 'fulltextdb/fulltexttbl'; -- 모두 소문자
SELECT word, doc_count, doc_id, position 
FROM INFORMATION_SCHEMA.INNODB_FT_INDEX_TABLE;

- '중지단어' 추가
DROP INDEX idx_description ON FulltextTbl;

CREATE TABLE user_stopword (value VARCHAR(30));
INSERT INTO user_stopword VALUES ('그는'), ('그리고'), ('극에');

SET GLOBAL innodb_ft_server_stopword_table = 'fulltextdb/user_stopword'; -- 모두 소문자
SHOW GLOBAL VARIABLES LIKE 'innodb_ft_server_stopword_table';

CREATE FULLTEXT INDEX idx_description ON FulltextTbl(description);

# 11.2 파티션
