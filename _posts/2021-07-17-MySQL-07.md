---
layout: post
title:  "이것이 MySQL이다 - 07. SQL 고급"
---

# 7.1 데이터 형식
- DECIMAL 정확한 수치를 저장. FLOAT/DOUBLE 근사치의 숫자 큰 숫자를 저장할 수 있음.
소수점이 들어간 실수를 저장하려면 되도록 DECIMAL 바람직
- TEXT 대용량 글자 저장. BLOB 사진,동영상,문서 파일 등

SET @myVar1 = 3;
PREPARE myQuery
	FROM 'SELECT Name, Height FROM usertbl ORDER BY height LIMIT ?';
EXECUTE myQuery USING @myVar1;

# 7.1.4 내장 함수
SELECT IF (100>200, '참이다', '거짓이다');
SELECT IFNULL(NULL, '널이군요'), IFNULL(100, '널이군요');
-- 같으면 NULL 반환, 다르면 수식1 반환
SELECT NULLIF(100, 100), NULLIF(200,100);

-- 24, 3, 3
SELECT BIT_LENGTH('abc'), CHAR_LENGTH('abc'), LENGTH('abc');
-- 72, 3, 9
SELECT BIT_LENGTH('가나다'), CHAR_LENGTH('가나다'), LENGTH('가나다');

SELECT CONCAT_WS('/', '2025', '01', '01');
-- 2025/01/01

SELECT ELT(2, '하나', '둘, ''셋'), FIELD('둘', '하나', '둘', '셋'),
	FIND_IN_SET('둘', '하나,둘,셋'), INSTR('하나둘셋', '둘'), LOCATE('둘', '하나둘셋');
LOCATE = POSITION

SELECT FORMAT(123456.123456, 4);
-- 123,456.1235

SELECT INSERT('abcdefghi', 3, 4, '@@@@');
-- ab@@@@ghi

LOWER() = LCASE(), UPPER = UCASE()

SELECT LPAD('이것이', 5, '##'), RPAD('이것이', 5, '##');
-- ##이것이, 이것이##

SELECT SUBSTRING_INDEX('cafe.naver.com', '.', 2), SUBSTRING_INDEX('cafe.naver.com', '.', -2);
-- cafe.naver, naver.com

CEILING : 올림, FLOOR : 내림, ROUND : 반올림

SELECT MOD(157, 10), 157 % 10, 157 MOD 10;

SELECT ADDTIME('2025-01-01 23:59:59', '1:1:1'), SUBTIME('2025-01-01 23:59:59', '1:1:1');
SELECT ADDDATE('2025-01-01', INTERVAL 1 MONTH), SUBDATE('2025-01-01', INTERVAL 1 MONTH);

SELECT CURRENT_USER(), DATABASE();

-- 바로 앞의 SELECT문에서 조회된 행의 개수
SELECT * FROM usertbl;
SELECT FOUND_ROWS();

-- 바로 앞의 I,U,D 개수
UPDATE buytbl SET price = price * 2;
SELECT ROW_COUNT();

SELECT SLEEP(5);

CREATE TABLE movietbl
(
	movie_id INT
    , movie_script LONGTEXT
    , movie_film LONGBLOB
);

INSERT INTO movietbl VALUES (1, LOAD_FILE('C:\BACKUP\movies\Schindler.txt'), LOAD_FILE('C:\BACKUP\movies\Schindler.mp4'));

SELECT * FROM movietbl;
/*
NULL 표시된다. 이유는 아래 2가지.
1. 최대 패킷 크기(=최대 파일 크기) max_allowed_packet
*/
SHOW variables LIKE 'max_allowed_packet';
-- 4194304 = 4MB 수정필요
-- 파일 업로드/다운로드할 폴더 경로를 별도로 허용해 줘야 함
SHOW variables LIKE 'secure_file_priv';
-- C:\ProgramData\MySQL\MySQL Server 8.0\Uploads\

최대 파일 크기 및 허용된 파일의 경로를 추가. 우선 Workbench 종료
..자세한건 필요할때 책으로!!

# 피벗
SELECT uName, 
  SUM(IF(season='봄', amount, 0)) AS '봄', 
  SUM(IF(season='여름', amount, 0)) AS '여름',
  SUM(amount) AS '합계' FROM pivotTest GROUP BY uName ;

# 7.2 
